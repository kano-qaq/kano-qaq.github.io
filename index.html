<!DOCTYPE html>
<html lang="cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Record my life">
<meta property="og:type" content="website">
<meta property="og:title" content="kkano">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="kkano">
<meta property="og:description" content="Record my life">
<meta property="og:locale">
<meta property="article:author" content="kkano">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'cn'
  };
</script>

  <title>kkano</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">kkano</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/01/29/KERNEL-64-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kkano">
      <meta itemprop="description" content="Record my life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kkano">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/01/29/KERNEL-64-02/" class="post-title-link" itemprop="url">KERNEL-64-02</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-29 12:38:20" itemprop="dateCreated datePublished" datetime="2024-01-29T12:38:20+08:00">2024-01-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-02-18 18:49:08" itemprop="dateModified" datetime="2024-02-18T18:49:08+08:00">2024-02-18</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>文件过滤驱动:<br>1.通过在文件系统上attach过滤驱动来进行文件操作的拦截和修改<br>2.minifilter，通过调用flt系列的api来注册文件过滤驱动</p>
<p>网络过滤驱动:<br>1.TDI层过滤有进程信息，NDIS层过滤没有进程信息<br>2.通过调用wfp系列的api来注册网络过滤驱动</p>
<p>进程对抗<br>1.隐藏进程的方法:进程链表断链，抹去PID获取进程对象的表<br>2.搜素隐藏进程:内存搜索进程对象特征<br>3.通过调用底层api来结束进程</p>
<p>文件占用解除<br>1.减少文件引用计数</p>
<p>PG保护<br>1.静态过保护，对内核文件和文件加载器打补丁<br>2.动态过保护，通过枚举内存池修改内存属性来捕获PG代码</p>
<p>VT技术<br>1.通过vt使得物理机陷入虚拟机状态来过PG保护</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/01/23/KERNEL-64-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kkano">
      <meta itemprop="description" content="Record my life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kkano">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/01/23/KERNEL-64-01/" class="post-title-link" itemprop="url">KERNEL-64-01</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-23 18:44:16" itemprop="dateCreated datePublished" datetime="2024-01-23T18:44:16+08:00">2024-01-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-01-29 12:37:54" itemprop="dateModified" datetime="2024-01-29T12:37:54+08:00">2024-01-29</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>64内核<br>1.分段机制弃用<br>2.线性地址48位，物理地址52位<br>3.页的大小为4KB，2MB，1GB<br>4.系统调用由sysenter&#x3D;&gt;syscall，且TEB改为gs寄存器</p>
<p>wow64子系统<br>1.用于给32位程序来调用64位的系统调用<br>32位&#x3D;&gt;64位:  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">push    0x33;64位的段</span><br><span class="line">call    $+5</span><br><span class="line">add     dword ptr [esp],5</span><br><span class="line">retf     ;切为64位</span><br><span class="line">...      ;64位的汇编</span><br><span class="line">call    $+5</span><br><span class="line">mov     dword ptr [esp+4],0x23;32位的段</span><br><span class="line">add     dword ptr [esp],0x0d</span><br><span class="line">retf     ;切为32位</span><br><span class="line">ret</span><br></pre></td></tr></table></figure>
<p>过强制驱动签名<br>通过有任意地址写的漏洞的驱动来修改全局变量</p>
<p>官方系统回调:<br>1.进程PsSetCreateProcessNotifyRoutine<br>2.线程PsSetCreateThreadNotifyRoutine<br>3.模块PsSetLoadImageNotifyRoutine<br>4.文件系统IoRegistFsRegistrationChangeString<br>5.注册表CmRegistCallback<br>6.错误检测KeRegisterBugCheckCallBack,KeRegisterBugCheckReasonCallBack</p>
<p>分层过滤驱动:<br>1.上层驱动需要为下层驱动准备Irp堆栈<br>2.上层驱动通过注册完成例程来获取下层驱动的数据<br>3.如果下层驱动被挂起那么上层驱动同样要挂起</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/01/23/KERNEL-32-06/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kkano">
      <meta itemprop="description" content="Record my life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kkano">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/01/23/KERNEL-32-06/" class="post-title-link" itemprop="url">KERNEL-32-06</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-01-23 18:43:13 / Modified: 18:43:53" itemprop="dateCreated datePublished" datetime="2024-01-23T18:43:13+08:00">2024-01-23</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>中断描述表(IDT)<br>1.有三种描述符:任务描述符，中断描述符和陷阱描述符<br>2.中断表hook:IDT表项hook和inlinehook</p>
<p>任务状态段(TSS)<br>1.用于保存任务的寄存器环境，提高切换任务的速度</p>
<p>调用门实现api<br>R0:<br>1.将系统调用代理函数的选择子和偏移写入调用门描述符，描述符填入gdt<br>2.代理函数中,eax&#x3D;功能号,edx&#x3D;调用者的esp<br>3.参数栈拷贝<br>4.retf返回</p>
<p>R3:<br>1.通过jmp far ptr select:offset指令转移到代理函数</p>
<p>FastSystemCall<br>1.通过msr寄存器来切换R3&#x3D;&gt;R0<br>2.通过sysenter指令进入R0,sysexit指令离开R0</p>
<p>SSDT:非UI的系统调用<br>ShadowSSDT:UI的系统调用</p>
<p>SSDT Hook<br>通过修改kthread结构体指向的地址进行hook</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/01/19/KERNEL-32-05/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kkano">
      <meta itemprop="description" content="Record my life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kkano">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/01/19/KERNEL-32-05/" class="post-title-link" itemprop="url">KERNEL-32-05</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-01-19 10:47:04 / Modified: 10:47:41" itemprop="dateCreated datePublished" datetime="2024-01-19T10:47:04+08:00">2024-01-19</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>物理地址扩展<br>物理地址由32位变为36位，此时页大小只有4KB和2MB<br>4KB页通过三级页表查询，PDE和PTE大小为8字节</p>
<p>三环零地址不可访问的原因:没有映射的页表项</p>
<p>windows内存管理<br>每个进程都通过一个平衡二叉树来记录线性地址和物理的关系</p>
<p>内核遍历进程:<br>1.通过API函数ZwQuerySystemInformation来遍历<br>2.手动通过遍历进程链表来遍历</p>
<p>读&#x2F;写进程内存:<br>API:<br>1.通过进程Pid获取进程对象,PsLookupProcessByProcessId<br>2.切换进程环境,KeStackAttachProcess<br>3.判断线性地址对应的物理地址是否存在<br>4.获取线性地址的物理地址，将物理地址映射线性地址，防止缺页<br>5.屏蔽中断信号,CLI<br>6.读&#x2F;写内存<br>7.设置中断信号<br>8.恢复回进程环境,KeUnstackDetachProcess</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/01/13/KERNEL-32-04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kkano">
      <meta itemprop="description" content="Record my life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kkano">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/01/13/KERNEL-32-04/" class="post-title-link" itemprop="url">KERNEL-32-04</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-01-13 12:26:21 / Modified: 12:27:10" itemprop="dateCreated datePublished" datetime="2024-01-13T12:26:21+08:00">2024-01-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>双机调试:<br>1.被调试机设置启动为调试模式<br>2.windbg设置为通过管道通信</p>
<p>通过段描述符来分段</p>
<p>地址转换:<br>逻辑地址 &#x3D;&gt; 分段机制 &#x3D;&gt;线性地址 &#x3D;&gt;分页机制 &#x3D;&gt; 物理地址<br>其中虚拟地址是逻辑地址组成的一部分</p>
<p>段描述符:<br>AVL位:提供给操作系统作者自行使用<br>BASE:段基址<br>D&#x2F;B:1&#x3D;32bit的段&#x2F;0&#x3D;16bit的段<br>DPL:描述符的特权级(ring0~ring3)<br>G:粒度,0&#x3D;1Byte&#x2F;1&#x3D;4KByte<br>LIMIT:段界限<br>P:段是否存在<br>S:描述符类型,0&#x3D;system&#x2F;1&#x3D;code or data<br>TYPE:段的类型</p>
<p>mfc使用驱动的宏:包含winioctl.h文件<br>资源相对路径编译:res\资源名</p>
<p>分页机制:<br>4KB页:将线性地址分为高10位，中10位和低12位，高10位作为页目录的下标，中10位作为页表的下标，低12位作为页内偏移<br>4MB分页:将线性地址分为高10位和低22位，高10位作为页目录的下标，低22位作为页内偏移</p>
<p>页的扩展由控制寄存器cr4控制<br>PAE(5 bit):物理地址扩展<br>PGE(4 bit):页大小扩展</p>
<p>页的实际大小由PDE的PS位和CR4的PSE位共同控制。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/01/09/KERNEL-32-03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kkano">
      <meta itemprop="description" content="Record my life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kkano">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/01/09/KERNEL-32-03/" class="post-title-link" itemprop="url">KERNEL-32-03</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-01-09 13:29:39 / Modified: 13:30:45" itemprop="dateCreated datePublished" datetime="2024-01-09T13:29:39+08:00">2024-01-09</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>内核API<br>内存检测:<br>1.MmIsAddressValid()检测内核地址是否有效<br>2.ProbeForRead()&#x2F;ProbeForWrite()检测用户模式缓冲区是否可读&#x2F;可写，此函数没有返回值，通过异常处理基址判断</p>
<p>文件的表示:<br>应用层表示:c:\1.txt<br>内核表示:\??\C:\1.txt</p>
<p>注册表表示:<br>应用层表示:HKEY_CLASSES_ROOT，HKEY_CURRENT_USER，HKEY_LOCAL_MACHINE，HKEY_USERS，HKEY_CURRENT_CONFIG<br>内核表示:<br>内核中所有注册表项的根目录都是\Registry，HKEY_LOCAL_MACHINE对应\Registry\Machine<br>在内核中只有HKEY_USERS和HKEY_LOCAL_MACHINE的句柄</p>
<p>中断请求级别:<br>1.高中断级别可以中断低中断级别，同中断级别不能打断<br>2.通常中断级别:PASSIVE_LEVEL(0)，APC_LEVEL(1)，DISPATCH_LEVEL(2)<br>3.内核API对于中断级有要求</p>
<p>Ring3和Ring0通信<br>1.通过事件对象实现通信<br>ring0:IoCreateNotificationEvent(L“\BaseNamedObjects\xxx(MyName)”)<br>ring3:OpenEvent(L“\Global\xxx(MyName)”)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/01/07/KERNEL-32-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kkano">
      <meta itemprop="description" content="Record my life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kkano">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/01/07/KERNEL-32-02/" class="post-title-link" itemprop="url">KERNEL-32-02</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-01-07 20:47:40 / Modified: 20:55:32" itemprop="dateCreated datePublished" datetime="2024-01-07T20:47:40+08:00">2024-01-07</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>windows分层设计:<br>1.一个设备可以有多个驱动<br>2.上层驱动会附加到下层驱动<br>3.处理消息时，从上层驱动开始处理，若上层驱动直接返回则下层驱动不处理</p>
<p>派遣函数<br>1.通过Irp堆栈获取参数，获取Irp:pIrpStack&#x3D;IoGetCurrentIrpStackLoaction(Irp)<br>2.需要调用IoCompleteRequest函数来完成请求</p>
<p>数据通信方式<br>1.缓冲区通讯方式(由系统申请一块内存来操作数据)<br>2.直接通讯方式(直接操作物理内存)<br>3.其他方式<br>4.设置数据通信方式:  </p>
<ul>
<li>DriverEntry中的DriverObject-&gt;Flags与上通讯方式的宏  </li>
<li>控制码的定义中声明相应的通讯方式宏</li>
</ul>
<p>控制派遣函数:<br>1.缓冲区通讯方式时，输入和输出缓冲区地址相同&#x3D;Irp-&gt;AssociatedIrp.SystemBuffer<br>2.其他方式时:  </p>
<ul>
<li>输入缓冲区&#x3D;pIrpStack-&gt;Parameters.DeviceIoControl.Type3InputBuffer  </li>
<li>输出缓冲区&#x3D;Irp-&gt;UserBuffer<br>3.直接通讯方式时，控制码声明时为METHOD_IN_DIRECT，则MmGetSystemAddressForMdlSafe(Irp-&gt;MdlAddress,NormalPagePriority)返回输入缓冲区。输出同理。</li>
</ul>
<p>内存池:<br>1.分页内存池(会进行内存&lt;&#x3D;&gt;硬盘的替换)<br>2.非分页内存池(申请后一直占有直到释放)<br>3.函数声明为分页内存:#pragma alloc_text(“PAGE”,FuncName1)<br>4.声明的第一个参数为”INIT”时，函数在推出后会自动释放内存</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/01/05/KERNEL-32-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kkano">
      <meta itemprop="description" content="Record my life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kkano">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/01/05/KERNEL-32-01/" class="post-title-link" itemprop="url">KERNEL-32-01</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-01-05 11:01:37 / Modified: 11:02:42" itemprop="dateCreated datePublished" datetime="2024-01-05T11:01:37+08:00">2024-01-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>驱动模型:<br>1.NT模型<br>2.WDM驱动模型<br>3.UMDF驱动模型<br>4.KMDF驱动模型</p>
<p>所有的硬件都被抽象为文件<br>windows系统通过I&#x2F;O管理器管理驱动</p>
<p>一个驱动对象可以绑定多个设备对象，一个设备对象只能绑定一个驱动对象</p>
<p>NT框架:<br>1.需要为驱动的操作注册回调函数<br>2.创建一个虚拟设备(ring0权限)<br>3.为设备创建符号链接，来让ring3程序可以使用</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/12/31/RE17/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kkano">
      <meta itemprop="description" content="Record my life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kkano">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/12/31/RE17/" class="post-title-link" itemprop="url">RE17</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-12-31 13:55:29 / Modified: 13:56:47" itemprop="dateCreated datePublished" datetime="2023-12-31T13:55:29+08:00">2023-12-31</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>x64异常处理<br>1.通过异常节(通常名为.pdata)储存RUNTIME_FUNCTION结构体信息<br>RUNTIME_FUNCTION:<br>DWORD BeginAddress<br>DWORD EndAddress<br>DWORD UnwindInfoAddress<br>2.通过UNWIND_INFO结构体解析后续为异常处理还是展开信息<br>3.通过IPtoStateMap来确定try的范围<br>4.第三代异常信息和x86的一样</p>
<p>第四代异常处理:<br>FuncInfo4:<br>1.需要通过解析FuncInfoHeader来确定表<br>2.通过FuncInfoHeader解析表</p>
<p>UWMap4:<br>1.数量通过ReadUnsigned函数解析</p>
<p>TryBlockMap4:<br>1.数量通过ReadUnsigned函数解析<br>2.根据数量解析TryBlockMapEntry4<br>3.tryLow,tryHigh,catchHigh通过ReadUnsigned解析</p>
<p>HandlerMap4<br>1.数量通过ReadUnsigned函数解析<br>2.通过HandlerType4解析相关信息和处理函数的地址</p>
<p>IPtoStateMap4:<br>1.数量通过ReadUnsigned函数解析<br>2.函数相对地址通过ReadUnsigned函数解析，并且作为下一个相对地址的基址<br>3.状态通过ReadUnsigned函数解析</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/12/26/RE16/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kkano">
      <meta itemprop="description" content="Record my life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kkano">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/12/26/RE16/" class="post-title-link" itemprop="url">RE16</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-12-26 21:35:37" itemprop="dateCreated datePublished" datetime="2023-12-26T21:35:37+08:00">2023-12-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-12-31 13:57:18" itemprop="dateModified" datetime="2023-12-31T13:57:18+08:00">2023-12-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>(非2的幂)还原方式:<br>1.除数为正数:c&#x3D;2^n&#x2F;M<br>2.除数为负数:c&#x3D;2^n&#x2F;(2^(32&#x2F;64)+M)<br>3.正数溢出:c&#x3D;2^n&#x2F;(2^(32&#x2F;64)+M)  </p>
<p>(2的幂)还原方式:<br>x&#x2F;2^n-1+1</p>
<p>有符号求余<br>x&gt;&#x3D;0时:<br>x%2^n&#x3D;((x+0)&amp;2^n-1)-0<br>x&lt;0时:<br>x%2^n&#x3D;((x+2^n-1)&amp;2^n-1)-2^n-1</p>
<p>函数传参:<br>1.参数大小不为1,2,4,8则通过引用传参</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">kkano</p>
  <div class="site-description" itemprop="description">Record my life</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">132</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kkano</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
